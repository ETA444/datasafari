<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>datasafari.evaluator.evaluate_normality - DataSafari Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">DataSafari Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logos/ds-branding-logo-big-lightmode.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logos/ds-branding-logo-big-darkmode.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">DataSafari Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glance.html">Subpackages Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explorers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../explorers/explore_df.html">explore_df()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../explorers/explore_num.html">explore_num()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../explorers/explore_cat.html">explore_cat()</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Transformers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../transformers/transform_num.html">transform_num()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformers/transform_cat.html">transform_cat()</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Evaluators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluators/evaluate_normality.html">evaluate_normality()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluators/evaluate_variance.html">evaluate_variance()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluators/evaluate_dtype.html">evaluate_dtype()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluators/evaluate_contingency_table.html">evaluate_contingency_table()</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Predictors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../predictors/predict_hypothesis.html">predict_hypothesis()</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../predictors/predict_ml.html">predict_ml()</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../other/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">General Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/lic-gpl3.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/contact.html">Contact</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for datasafari.evaluator.evaluate_normality</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">shapiro</span><span class="p">,</span> <span class="n">anderson</span><span class="p">,</span> <span class="n">normaltest</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">lilliefors</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datasafari.evaluator.evaluate_dtype</span> <span class="kn">import</span> <span class="n">evaluate_dtype</span>


<div class="viewcode-block" id="evaluate_normality">
<a class="viewcode-back" href="../../../evaluators/evaluate_normality.html#datasafari.evaluator.evaluate_normality">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_normality</span><span class="p">(</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">grouping_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;consensus&#39;</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Evaluate normality of numerical data within groups defined by a categorical variable, employing multiple statistical tests, dynamically chosen based on data suitability.**</span>

<span class="sd">    This function offers a comprehensive examination of the distribution&#39;s normality by utilizing tests like Shapiro-Wilk, Anderson-Darling, D&#39;Agostino and Pearson&#39;s test, and Lilliefors. Each test provides insights into different aspects of normality, and the consensus method integrates these perspectives to make a more informed decision.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        The DataFrame containing the data to be tested.</span>

<span class="sd">    target_variable : str</span>
<span class="sd">        The name of the numeric variable to test for normality.</span>

<span class="sd">    grouping_variable : str</span>
<span class="sd">        The name of the categorical variable used to create subsets of data for normality testing.</span>

<span class="sd">    method : str, optional, default: &#39;consensus&#39;</span>
<span class="sd">        The method to use for testing normality.</span>
<span class="sd">            - ``&#39;shapiro&#39;`` Shapiro-Wilk test</span>
<span class="sd">            - ``&#39;anderson&#39;`` Anderson-Darling test</span>
<span class="sd">            - ``&#39;normaltest&#39;`` D&#39;Agostino and Pearson&#39;s test</span>
<span class="sd">            - ``&#39;lilliefors&#39;`` Lilliefors test</span>
<span class="sd">            - ``&#39;consensus&#39;`` A combination of the above tests.</span>

<span class="sd">    pipeline : bool, optional, default: False</span>
<span class="sd">        - ``True`` Simplifies the output to a boolean indicating the consensus on normality. Useful for integration into automated analysis pipelines.</span>
<span class="sd">        - ``False`` The output is a dictionary containing results of the respective test(s).</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict or bool</span>
<span class="sd">        - ``dict`` If pipeline=False, returns a dictionary with test names as keys and test results, including statistics, p-values, and normality conclusions, as values.</span>
<span class="sd">        - ``bool`` If pipeline=True, returns a boolean indicating the consensus on normality across all tests, or if consensus method was not used a boolean indicating the result of that test.</span>

<span class="sd">    Raises:</span>
<span class="sd">    -------</span>
<span class="sd">    TypeErrors:</span>
<span class="sd">        - If `df` is not a pandas DataFrame.</span>
<span class="sd">        - If `target_variable` or `grouping_variable` is not a string.</span>
<span class="sd">        - If `method` is not a string.</span>
<span class="sd">        - If `pipeline` is not a boolean.</span>

<span class="sd">    ValueErrors:</span>
<span class="sd">        - If the `df` is empty.</span>
<span class="sd">        - If the `target_variable` or `grouping_variable` does not exist in the DataFrame.</span>
<span class="sd">        - If the `method` specified is not supported.</span>
<span class="sd">        - If the `target_variable` is not numerical, or if the `grouping_variable` is not categorical, as determined by evaluating their data types with :doc:`evaluate_dtype() &lt;evaluate_dtype&gt;`.</span>

<span class="sd">    Examples:</span>
<span class="sd">    ---------</span>
<span class="sd">    Example 1: Using the consensus method to evaluate normality in a DataFrame:</span>

<span class="sd">    &gt;&gt;&gt; import datasafari</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">    ...     &#39;Group&#39;: np.random.choice([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;], size=100),</span>
<span class="sd">    ...     &#39;Data&#39;: np.random.normal(0, 1, size=100)</span>
<span class="sd">    ... })</span>
<span class="sd">    &gt;&gt;&gt; normality_result = evaluate_normality(df, &#39;Data&#39;, &#39;Group&#39;)</span>

<span class="sd">    Example 2: Using the function in a comprehensive evaluation pipeline:</span>

<span class="sd">    &gt;&gt;&gt; pipeline_result = evaluate_normality(df, &#39;Data&#39;, &#39;Group&#39;, pipeline=True)</span>
<span class="sd">    &gt;&gt;&gt; if pipeline_result:</span>
<span class="sd">    ...     # your pipeline in the case normality is validated</span>
<span class="sd">    ... else:</span>
<span class="sd">    ...     # your pipeline in the case normality is not validated</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    **Consensus Method:**</span>
<span class="sd">    The consensus method integrates results from multiple statistical tests to provide a comprehensive assessment of the normality of data distributions.</span>

<span class="sd">        Here is how the consensus method operates:</span>
<span class="sd">            1. **Test Execution**:</span>

<span class="sd">               - **Shapiro-Wilk Test**: Assesses normality based on the correlation between data and corresponding normal scores, ideal for small sample sizes.</span>
<span class="sd">               - **Anderson-Darling Test**: Focuses more on the tails of the distribution, suitable for any sample size.</span>
<span class="sd">               - **D&#39;Agostino-Pearson Test**: Combines skewness and kurtosis to assess normality, best for larger datasets.</span>
<span class="sd">               - **Lilliefors Test**: An adaptation of the Kolmogorov-Smirnov test that does not require known mean and variance, useful for small to medium samples.</span>

<span class="sd">            2. **Outcome Evaluation**: Each test provides a conclusion on whether the data follow a normal distribution.</span>

<span class="sd">            3. **Majority Rule**: The final consensus on normality is based on the majority of test outcomes. If more tests conclude &#39;normal&#39;, the consensus is that the data are normally distributed. Conversely, if more tests conclude &#39;non-normal&#39;, the consensus is that the data are not normally distributed.</span>

<span class="sd">            4. **Tie-Breaker**: In the event of a tie (an equal number of &#39;normal&#39; and &#39;non-normal&#39; outcomes), the results of the Shapiro-Wilk and Anderson-Darling tests are given precedence. These tests are chosen because of their robustness and widespread acceptance in statistical testing. If both agree, their conclusion is adopted; if they disagree, further analysis may be required to determine normality.</span>

<span class="sd">    This structured approach ensures a thorough and balanced evaluation of normality, accommodating different sample sizes and distribution characteristics, which enhances the reliability of the statistical analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Error Handling</span>
    <span class="c1"># TypeErrors</span>
    <span class="c1"># Check if &#39;df&#39; is a pandas DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;evaluate_normality(): The &#39;df&#39; parameter must be a pandas DataFrame.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if &#39;target_variable&#39; and &#39;grouping_variable&#39; are strings</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_variable</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping_variable</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;evaluate_normality(): The &#39;target_variable&#39; and &#39;grouping_variable&#39; parameters must be strings.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if &#39;method&#39; is a string</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;evaluate_normality(): The &#39;method&#39; parameter must be a string.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if &#39;pipeline&#39; is a boolean</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;evaluate_normality(): The &#39;pipeline&#39; parameter must be a boolean.&quot;</span><span class="p">)</span>

    <span class="c1"># ValueErrors</span>
    <span class="c1"># Check if df is empty</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;evaluate_normality(): The input DataFrame is empty.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the specified columns exist in the DataFrame</span>
    <span class="k">if</span> <span class="n">target_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluate_normality(): The target variable &#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39; was not found in the DataFrame.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">grouping_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluate_normality(): The grouping variable &#39;</span><span class="si">{</span><span class="n">grouping_variable</span><span class="si">}</span><span class="s2">&#39; was not found in the DataFrame.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the specified columns are the appropriate dtypes</span>
    <span class="n">target_variable_is_numerical</span> <span class="o">=</span> <span class="n">evaluate_dtype</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="n">target_variable</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;list_n&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_variable_is_numerical</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluate_normality(): The target variable &#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39; must be a numerical variable.&quot;</span><span class="p">)</span>

    <span class="n">grouping_variable_is_categorical</span> <span class="o">=</span> <span class="n">evaluate_dtype</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="n">grouping_variable</span><span class="p">],</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;list_c&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">grouping_variable_is_categorical</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluate_normality(): The grouping variable &#39;</span><span class="si">{</span><span class="n">grouping_variable</span><span class="si">}</span><span class="s2">&#39; must be a categorical variable.&quot;</span><span class="p">)</span>

    <span class="c1"># Check if the method specified is one of the allowed methods</span>
    <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;shapiro&#39;</span><span class="p">,</span> <span class="s1">&#39;anderson&#39;</span><span class="p">,</span> <span class="s1">&#39;normaltest&#39;</span><span class="p">,</span> <span class="s1">&#39;lilliefors&#39;</span><span class="p">,</span> <span class="s1">&#39;consensus&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_methods</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evaluate_normality(): The method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; is not supported. Allowed methods are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed_methods</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="c1"># Main Functionality</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># define output objects</span>
    <span class="n">output_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># non-pipeline</span>
    <span class="n">normality_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># pipeline single-method</span>
    <span class="n">normality_consensus</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># pipeline consensus method</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;shapiro&#39;</span><span class="p">,</span> <span class="s1">&#39;consensus&#39;</span><span class="p">]:</span>
        <span class="c1"># calculating statistic and p-values to define normality</span>
        <span class="n">shapiro_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">shapiro</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">statistic</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">shapiro_pvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">shapiro</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">pvalue</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">shapiro_normality</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">shapiro_pvals</span><span class="p">]</span>

        <span class="c1"># save the info for return and text for output</span>
        <span class="n">shapiro_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">group</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="n">shapiro_stats</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">shapiro_pvals</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;normality&#39;</span><span class="p">:</span> <span class="n">shapiro_normality</span><span class="p">[</span><span class="n">n</span><span class="p">]}</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">)}</span>
        <span class="n">shapiro_text</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Results for &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; group in variable [&#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39;]:</span><span class="se">\n</span><span class="s2">  ➡ statistic: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">  ➡ p-value: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: Yes (H0 cannot be rejected)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: No (H0 rejected)&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">shapiro_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">shapiro_title</span> <span class="o">=</span> <span class="s2">&quot;&lt; NORMALITY TESTING: SHAPIRO-WILK &gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">shapiro_tip</span> <span class="o">=</span> <span class="s2">&quot;☻ Tip: The Shapiro-Wilk test is particularly well-suited for small sample sizes (n &lt; 50) and is considered one of the most powerful tests for assessing normality. It is sensitive to departures from normality, making it a preferred choice for rigorous normality assessments in small datasets.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># save info in return object and conditionally print to console</span>
        <span class="n">output_info</span><span class="p">[</span><span class="s1">&#39;shapiro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shapiro_info</span>
        <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;shapiro_group_consensus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">shapiro_normality</span><span class="p">)</span>

        <span class="c1"># end it here if non-consensus method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;shapiro&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">shapiro_title</span><span class="p">,</span> <span class="o">*</span><span class="n">shapiro_text</span><span class="p">,</span> <span class="n">shapiro_tip</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output_info</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;shapiro_group_consensus&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;anderson&#39;</span><span class="p">,</span> <span class="s1">&#39;consensus&#39;</span><span class="p">]:</span>
        <span class="c1"># calculating statistic to define normality</span>
        <span class="n">anderson_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">anderson</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">statistic</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">anderson_critical_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">anderson</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">critical_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">anderson_normality</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">c_val</span> <span class="o">&gt;</span> <span class="n">anderson_stats</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">anderson_critical_values</span><span class="p">)]</span>

        <span class="c1"># save the info for return and text for output</span>
        <span class="n">anderson_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">group</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="n">anderson_stats</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">anderson_critical_values</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;normality&#39;</span><span class="p">:</span> <span class="n">anderson_normality</span><span class="p">[</span><span class="n">n</span><span class="p">]}</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">)}</span>
        <span class="n">anderson_text</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Results for &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; group in variable [&#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39;]:</span><span class="se">\n</span><span class="s2">  ➡ statistic: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">  ➡ p-value: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: Yes (H0 cannot be rejected)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: No (H0 rejected)&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">anderson_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">anderson_title</span> <span class="o">=</span> <span class="s2">&quot;&lt; NORMALITY TESTING: ANDERSON-DARLING &gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">anderson_tip</span> <span class="o">=</span> <span class="s2">&quot;☻ Tip: The Anderson-Darling test is a versatile test that can be applied to any sample size and is especially useful for comparing against multiple distribution types, not just the normal. It places more emphasis on the tails of the distribution than the Shapiro-Wilk test, making it useful for detecting outliers or heavy-tailed distributions.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># saving info</span>
        <span class="n">output_info</span><span class="p">[</span><span class="s1">&#39;anderson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anderson_info</span>
        <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;anderson_group_consensus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">anderson_normality</span><span class="p">)</span>

        <span class="c1"># end it here if non-consensus method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;anderson&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">anderson_title</span><span class="p">,</span> <span class="o">*</span><span class="n">anderson_text</span><span class="p">,</span> <span class="n">anderson_tip</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output_info</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;anderson_group_consensus&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;normaltest&#39;</span><span class="p">,</span> <span class="s1">&#39;consensus&#39;</span><span class="p">]:</span>
        <span class="c1"># calculating statistic and p-values to define normality</span>
        <span class="n">normaltest_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">normaltest</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">statistic</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">normaltest_pvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">normaltest</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])</span><span class="o">.</span><span class="n">pvalue</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">normaltest_normality</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">normaltest_pvals</span><span class="p">]</span>

        <span class="c1"># save the info for return and text for output</span>
        <span class="n">normaltest_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">group</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="n">normaltest_stats</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">normaltest_pvals</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;normality&#39;</span><span class="p">:</span> <span class="n">normaltest_normality</span><span class="p">[</span><span class="n">n</span><span class="p">]}</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">)}</span>
        <span class="n">normaltest_text</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Results for &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; group in variable [&#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39;]:</span><span class="se">\n</span><span class="s2">  ➡ statistic: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">  ➡ p-value: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: Yes (H0 cannot be rejected)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: No (H0 rejected)&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">normaltest_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">normaltest_title</span> <span class="o">=</span> <span class="s2">&quot;&lt; NORMALITY TESTING: D&#39;AGOSTINO-PEARSON NORMALTEST &gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">normaltest_tip</span> <span class="o">=</span> <span class="s2">&quot;☻ Tip: The D&#39;Agostino-Pearson normality test, or simply &#39;normaltest&#39;, is best applied when the sample size is larger, as it combines skewness and kurtosis to form a test statistic. This test is useful for detecting departures from normality that involve asymmetry and tail thickness, offering a good balance between sensitivity and specificity in medium to large sample sizes.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># saving info</span>
        <span class="n">output_info</span><span class="p">[</span><span class="s1">&#39;normaltest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normaltest_info</span>
        <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;normaltest_group_consensus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">normaltest_normality</span><span class="p">)</span>

        <span class="c1"># end it here if non-consensus method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;normaltest&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">normaltest_title</span><span class="p">,</span> <span class="o">*</span><span class="n">normaltest_text</span><span class="p">,</span> <span class="n">normaltest_tip</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output_info</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;normaltest_group_consensus&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lilliefors&#39;</span><span class="p">,</span> <span class="s1">&#39;consensus&#39;</span><span class="p">]:</span>
        <span class="c1"># calculating statistic and p-values to define normality</span>
        <span class="n">lilliefors_stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">lilliefors</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">lilliefors_pvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">lilliefors</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">grouping_variable</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">][</span><span class="n">target_variable</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">lilliefors_normality</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lilliefors_pvals</span><span class="p">]</span>

        <span class="c1"># save the info for return and text for output</span>
        <span class="n">lilliefors_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">group</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;stat&#39;</span><span class="p">:</span> <span class="n">lilliefors_stats</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">lilliefors_pvals</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;normality&#39;</span><span class="p">:</span> <span class="n">lilliefors_normality</span><span class="p">[</span><span class="n">n</span><span class="p">]}</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="p">)}</span>
        <span class="n">lilliefors_text</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Results for &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; group in variable [&#39;</span><span class="si">{</span><span class="n">target_variable</span><span class="si">}</span><span class="s2">&#39;]:</span><span class="se">\n</span><span class="s2">  ➡ statistic: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;stat&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">  ➡ p-value: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: Yes (H0 cannot be rejected)&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">&#39;  ∴ Normality: No (H0 rejected)&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lilliefors_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">lilliefors_title</span> <span class="o">=</span> <span class="s2">&quot;&lt; NORMALITY TESTING: LILLIEFORS&#39; TEST &gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">lilliefors_tip</span> <span class="o">=</span> <span class="s2">&quot;☻ Tip: The Lilliefors test is an adaptation of the Kolmogorov-Smirnov test for normality with the benefit of not requiring the mean and variance to be known parameters. It&#39;s particularly useful for small to moderately sized samples and is sensitive to deviations from normality in the center of the distribution rather than the tails. This makes it complementary to tests like the Anderson-Darling when a comprehensive assessment of normality is needed.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># saving info</span>
        <span class="n">output_info</span><span class="p">[</span><span class="s1">&#39;lilliefors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lilliefors_info</span>
        <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;lilliefors_group_consensus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">lilliefors_normality</span><span class="p">)</span>

        <span class="c1"># end here if non-consensus method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lilliefors&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">lilliefors_title</span><span class="p">,</span> <span class="o">*</span><span class="n">lilliefors_text</span><span class="p">,</span> <span class="n">lilliefors_tip</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output_info</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;lilliefors_group_consensus&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;consensus&#39;</span><span class="p">:</span>
        <span class="c1"># the logic is that more than half of the tests need to give True for the consensus to be True</span>
        <span class="n">true_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_normality_consensus</span> <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">group_normality_consensus</span> <span class="ow">in</span> <span class="n">normality_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">false_count</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_normality_consensus</span> <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">group_normality_consensus</span> <span class="ow">in</span> <span class="n">normality_info</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">half_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normality_info</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">true_count</span> <span class="o">&gt;</span> <span class="n">half_point</span><span class="p">:</span>
            <span class="n">consensus_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">normality_info</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">normality_consensus_result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;  ➡ Result: Consensus is reached.</span><span class="se">\n</span><span class="s2">  ➡ </span><span class="si">{</span><span class="n">consensus_percent</span><span class="si">}</span><span class="s2">% of tests suggest Normality. *</span><span class="se">\n\n</span><span class="s2">* Detailed results of each test are provided below.</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># used only within predict_hypothesis() pipeline</span>
            <span class="n">normality_consensus</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">true_count</span> <span class="o">&lt;</span> <span class="n">half_point</span><span class="p">:</span>
            <span class="n">consensus_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">false_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">normality_info</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">normality_consensus_result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;  ➡ Result: Consensus is reached.</span><span class="se">\n</span><span class="s2">  ➡ </span><span class="si">{</span><span class="n">consensus_percent</span><span class="si">}</span><span class="s2">% of tests suggest Non-Normality. *</span><span class="se">\n\n</span><span class="s2">* Detailed results of each test are provided below:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># used only within predict_hypothesis() pipeline</span>
            <span class="n">normality_consensus</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">true_count</span> <span class="o">==</span> <span class="n">half_point</span><span class="p">:</span>
            <span class="c1"># the logic is that we default to the decisions of shapiro-wilk and anderson-darling (if both true then true) - internal use only</span>
            <span class="n">normality_consensus_result</span> <span class="o">=</span> <span class="s2">&quot;  ➡ Result: Consensus is not reached. (50% Normality / 50% Non-normality)</span><span class="se">\n\n</span><span class="s2">∴ Please refer to the results of each test below:</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># used only within predict_hypothesis() pipeline</span>
            <span class="n">normality_consensus</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;shapiro_group_consensus&#39;</span><span class="p">],</span> <span class="n">normality_info</span><span class="p">[</span><span class="s1">&#39;anderson_group_consensus&#39;</span><span class="p">]])</span>

        <span class="c1"># construct output and return</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt; NORMALITY TESTING: CONSENSUS &gt;</span><span class="se">\n</span><span class="s2">The consensus method bases its conclusion on 4 tests: Shapiro-Wilk test, Anderson-Darling test, D&#39;Agostino-Pearson test, Lilliefors test. (Note: More than 50% must have the same outcome to reach consensus. In predict_hypothesis(), if consensus is not reached normality is settled based on Shapiro-Wilk and Anderson-Darling outcomes)</span><span class="se">\n\n</span><span class="si">{</span><span class="n">normality_consensus_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">shapiro_title</span><span class="p">,</span> <span class="o">*</span><span class="n">shapiro_text</span><span class="p">,</span> <span class="n">shapiro_tip</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">anderson_title</span><span class="p">,</span> <span class="o">*</span><span class="n">anderson_text</span><span class="p">,</span> <span class="n">anderson_tip</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">normaltest_title</span><span class="p">,</span> <span class="o">*</span><span class="n">normaltest_text</span><span class="p">,</span> <span class="n">normaltest_tip</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">lilliefors_title</span><span class="p">,</span> <span class="o">*</span><span class="n">lilliefors_text</span><span class="p">,</span> <span class="n">lilliefors_tip</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_info</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="n">normality_consensus</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, George Dreemer
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=4e2eecee"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>