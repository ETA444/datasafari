# Disable Google's mod_pagespeed if present
<IfModule pagespeed_module>
	ModPagespeed off
</IfModule>

# Browser Caching: Set caching rules to improve client-side performance
<IfModule mod_expires.c>
	ExpiresActive On
	ExpiresDefault "access plus 2 days"  # Default caching period for unspecified types
	ExpiresByType image/gif "access plus 1 year"
	ExpiresByType image/png "access plus 1 year"
	ExpiresByType image/jpeg "access plus 1 year"
	ExpiresByType text/css "access plus 1 year"
	ExpiresByType text/javascript "access plus 1 year"
	ExpiresByType application/javascript "access plus 1 year"
	ExpiresByType font/otf "access plus 1 year"  # Extending caching for fonts
	ExpiresByType font/ttf "access plus 1 year"
	ExpiresByType font/woff "access plus 1 year"
	ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# GZIP Compression: Enable compression to reduce the size of files sent over the network
<IfModule mod_deflate.c>
	AddOutputFilterByType DEFLATE text/plain
	AddOutputFilterByType DEFLATE text/html
	AddOutputFilterByType DEFLATE text/xml
	AddOutputFilterByType DEFLATE text/css
	AddOutputFilterByType DEFLATE application/xml
	AddOutputFilterByType DEFLATE application/xhtml+xml
	AddOutputFilterByType DEFLATE application/rss+xml
	AddOutputFilterByType DEFLATE application/javascript
	AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Security: Prevents direct access to 'web.config' file on Apache servers
<FilesMatch "^(web\.config)$">
	<IfModule mod_authz_core.c>
		Require all denied
	</IfModule>
	<IfModule !mod_authz_core.c>
		Order allow,deny
	</IfModule>
</FilesMatch>

# Custom error documents
ErrorDocument 401 "Unauthorized"
ErrorDocument 403 "Forbidden"

# URL Rewriting: Handle authorization and server info, along with specific URL rules
<IfModule mod_negotiation.c>
	#Options -MultiViews
</IfModule>
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP:Authorization} ^(.*)
RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]
RewriteCond %{HTTP:X-Server-Addr} ^(.*)
RewriteRule .* - [e=HTTP_X_SERVER_ADDR:%1]
RewriteRule ^\.well-known/.+ - [L]

# Directory Index: Specifies default files to serve when a directory is requested
DirectoryIndex index.php index.cgi index.html

# Rewrite Conditions: Check for existing files or specific paths to bypass normal rewrite rules
RewriteCond %{REQUEST_FILENAME} !-f [OR]
RewriteCond %{REQUEST_URI} ^\/(js\/(main\.js|bootstrap\.min\.js)|css\/([0-9a-f]+\.css|common\.css|site\.css|bootstrap\.min\.css)|sitemap\.xml)$
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ ncsitebuilder/$1 [L,QSA]
